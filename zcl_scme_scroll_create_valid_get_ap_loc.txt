METHOD get_ap_loc.

  DATA: lv_type         TYPE char10,  "Local variable for Type
        lv_stype        TYPE char10,  "Local variable for SType
        lv_type_config  TYPE textr,   "REMARKS field for Type
        lv_stype_config TYPE textr,   "REMARKS field for SType
        lv_config_found TYPE abap_bool.

  "Determine Type dynamically from configuration
  CLEAR: lv_type_config, lv_type.
  SELECT SINGLE remarks
    FROM zlog_exec_var CLIENT SPECIFIED
    INTO lv_type_config
    WHERE mandt = sy-mandt
      AND name  = 'ZSCM_APCODETYPE_FETCH'
      AND active = 'X'.

  IF sy-subrc = 0 AND lv_type_config IS NOT INITIAL.
    lv_type = lv_type_config.
  ELSE.
    "Fallback to existing constant if configuration not found
    lv_type = gc_ser.
  ENDIF.

  "Determine SType based on Import/Export scenario with dynamic config
  IF im_import = 'X' OR im_export = 'X' OR im_rexport = 'X'.
    "EXIM Scenario - Try primary configuration first
    CLEAR: lv_stype_config, lv_config_found.

    "Primary: Query ZSCM_SERTYPE_EXIM_FETCH
    SELECT SINGLE remarks
      FROM zlog_exec_var CLIENT SPECIFIED
      INTO lv_stype_config
      WHERE mandt = sy-mandt
        AND name  = 'ZSCM_SERTYPE_EXIM_FETCH'
        AND active = 'X'.

    IF sy-subrc = 0 AND lv_stype_config IS NOT INITIAL.
      lv_stype = lv_stype_config.
      lv_config_found = abap_true.
    ELSE.
      "Fallback: Query ZSCM_SERTYPE_QWIK_FETCH
      SELECT SINGLE remarks
        FROM zlog_exec_var CLIENT SPECIFIED
        INTO lv_stype_config
        WHERE mandt = sy-mandt
          AND name  = 'ZSCM_SERTYPE_QWIK_FETCH'
          AND active = 'X'.

      IF sy-subrc = 0 AND lv_stype_config IS NOT INITIAL.
        lv_stype = lv_stype_config.
        lv_config_found = abap_true.
      ENDIF.
    ENDIF.

    "Final fallback if no configuration found
    IF lv_config_found = abap_false.
      lv_stype = gc_logi.  "Use existing 'LOGI' as final fallback
    ENDIF.
  ELSE.
    "Non-EXIM Scenario - Use existing logic
    lv_stype = gc_logi.
  ENDIF.

  "Fetch AP location using determined Type and SType
  SELECT srno
         type
         stype
         werks
         ekgrp
         apcode
         scrldept
    FROM yscm_aploc CLIENT SPECIFIED
    INTO TABLE et_aploc
     WHERE mandt = sy-mandt
       AND type  = lv_type   "Use determined Type
       AND stype = lv_stype.  "Use determined SType
  IF sy-subrc = 0.
    SORT et_aploc BY type stype.
  ELSE.
    CLEAR : gw_return.
    gw_return-type    = gc_e.
    gw_return-message = 'AP Locations not found'(001).
    APPEND gw_return TO et_return.
  ENDIF.

ENDMETHOD.